<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Omino che Cade</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>
  <style>
    body { margin: 0; padding: 0; background: #87CEEB; }
    canvas { display: block; margin: auto; }
    #startBtn {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
      background: #ffcc00;
      border: none;
      border-radius: 8px;
    }
  </style>
</head>
<body>

<button id="startBtn">Fai cadere l'omino</button>

<script>
class Gioco extends Phaser.Scene {
    constructor() {
        super('Gioco');
    }

    preload() {
        // Carica le immagini
        this.load.image('sfondo', 'sfondo.jpg');
        this.load.image('omino', 'burger.png');
        this.load.image('nuvola', 'nuvola.png');
    }

    create() {
        // Sfondo grande per seguire la caduta
        this.add.image(400, 300, 'sfondo').setScrollFactor(1, 1).setScale(2);

        // Attiva la fisica Matter.js
        this.matter.world.setBounds(0, 0, 800, 3000); // mondo più alto

        // Crea le nuvole statiche
        this.nuvole = [];
        for (let i = 0; i < 15; i++) {
            let x = Phaser.Math.Between(100, 700);
            let y = Phaser.Math.Between(200, 2800);
            let nuvola = this.matter.add.image(x, y, 'nuvola', null, { isStatic: true });
            nuvola.setScale(0.5);
            nuvola.setBounce(1);
            this.nuvole.push(nuvola);
        }

        // Personaggio (non ancora creato)
        this.omino = null;

        // Bottone per farlo cadere
        document.getElementById('startBtn').addEventListener('click', () => {
            this.faiCadereOmino();
        });
    }

    faiCadereOmino() {
        // Se esiste già, lo rimuoviamo prima
        if (this.omino) {
            this.omino.destroy();
        }

        // Crea l'omino in alto
        this.omino = this.matter.add.image(400, 50, 'omino');
        this.omino.setScale(0.4);
        this.omino.setCircle(); // collisione tonda
        this.omino.setBounce(0.9); // rimbalzo alto
        this.omino.setFriction(0.05); // poco attrito
        this.omino.setAngularVelocity(0.1); // rotazione iniziale

        // Telecamera che segue l'omino
        this.cameras.main.startFollow(this.omino, true, 0.05, 0.05);
    }

    update() {
        // Se cade fuori dal mondo, resetta
        if (this.omino && this.omino.y > 2900) {
            this.cameras.main.stopFollow();
        }
    }
}

const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    physics: {
        default: 'matter',
        matter: {
            gravity: { y: 1.2 } // più gravità
        }
    },
    scene: [Gioco]
};

new Phaser.Game(config);
</script>

</body>
</html>
