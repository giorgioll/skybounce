<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rock ‚Ä¢ Paper ‚Ä¢ Scissors</title>
  <!-- Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg: #ffffff;
      --fg: #111111;
      --muted:#666;
      --accent:#2b7;
      --card:#f3f5f7;
    }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif; background: var(--bg); color: var(--fg); }
    .wrap { max-width: 560px; margin: 0 auto; padding: 16px; }
    h1 { font-size: 22px; margin: 8px 0 12px; }
    .card { background: var(--card); border-radius: 14px; padding: 16px; }
    .row { display: flex; gap: 8px; }
    button { flex:1; padding: 14px 10px; border: 0; border-radius: 12px; background: #e9eef3; font-weight: 700; cursor: pointer; }
    button:active { transform: translateY(1px); }
    .log { padding: 12px; margin-top: 12px; background: #fff; border-radius: 12px; min-height: 54px; line-height: 1.35; }
    .muted { color: var(--muted); font-size: 13px; }
    .score { display:flex; justify-content:space-between; margin-top: 10px; font-weight: 700; }
    .tiny { font-size: 12px; }
    .footer { text-align: center; margin-top: 18px; }
    .link { font-size: 12px; color: var(--muted); }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Rock ‚Ä¢ Paper ‚Ä¢ Scissors</h1>
    <div class="card">
      <div class="row">
        <button data-move="rock">üóø Rock</button>
        <button data-move="paper">üìÑ Paper</button>
        <button data-move="scissors">‚úÇÔ∏è Scissors</button>
      </div>
      <div class="score" id="score">You 0 ‚Äî 0 Bot</div>
      <div class="log" id="log">Scegli una mossa per iniziare.</div>
      <div class="muted tiny">Pulsante ‚ÄúInvia risultato‚Äù appare in basso (Main Button) dentro Telegram.</div>
    </div>
    <div class="footer"><span class="link">Minimal WebApp ‚Äì nessuna grafica, solo testo/emoji.</span></div>
  </div>

  <script>
    // Telegram WebApp boilerplate
    const tg = window.Telegram?.WebApp;
    if (tg) {
      tg.expand();
      // Adatta ai temi scuri/chiari di Telegram
      const p = tg.themeParams || {};
      if (p.bg_color) document.documentElement.style.setProperty('--bg', '#' + p.bg_color);
      if (p.text_color) document.documentElement.style.setProperty('--fg', '#' + p.text_color);
      if (p.hint_color) document.documentElement.style.setProperty('--muted', '#' + p.hint_color);
      if (p.secondary_bg_color) document.documentElement.style.setProperty('--card', '#' + p.secondary_bg_color);

      tg.MainButton.setParams({ text: 'Send result to bot', is_visible: false });
      tg.onEvent('mainButtonClicked', () => {
        // Invio dei dati al bot: ultimo esito + punteggio
        const payload = JSON.stringify({ last, score });
        tg.sendData(payload);
      });
    }

    // Gioco
    const logEl = document.getElementById('log');
    const scoreEl = document.getElementById('score');
    const moves = ['rock','paper','scissors'];
    let score = { you: 0, bot: 0, rounds: 0 };
    let last = null;

    function botMove(){ return moves[Math.floor(Math.random()*3)]; }
    function judge(a,b){
      if (a===b) return 'draw';
      if (a==='rock' && b==='scissors') return 'win';
      if (a==='paper' && b==='rock') return 'win';
      if (a==='scissors' && b==='paper') return 'win';
      return 'lose';
    }

    function play(yourMove){
      const b = botMove();
      const res = judge(yourMove,b);
      score.rounds++;
      if (res==='win') score.you++; else if (res==='lose') score.bot++;
      last = { yourMove, botMove: b, result: res, rounds: score.rounds, you: score.you, bot: score.bot, ts: Date.now() };
      scoreEl.textContent = `You ${score.you} ‚Äî ${score.bot} Bot`;
      const pretty = { rock:'üóø Rock', paper:'üìÑ Paper', scissors:'‚úÇÔ∏è Scissors' };
      const msg = res==='win' ? 'Hai vinto ‚úÖ' : res==='lose' ? 'Hai perso ‚ùå' : 'Pareggio ‚ûñ';
      logEl.textContent = `${msg}  Tu: ${pretty[yourMove]}  ‚Ä¢  Bot: ${pretty[b]}`;
      if (tg) tg.MainButton.show();
    }

    document.querySelectorAll('button[data-move]').forEach(btn=>{
      btn.addEventListener('click', ()=> play(btn.dataset.move));
    });
  </script>
</body>
</html>